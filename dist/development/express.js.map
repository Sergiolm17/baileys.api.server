{"version":3,"file":"express.js","names":["exception","handle","setMaxListners","config","app","express","http","createServer","use","cors","json","limit","urlencoded","extended","boolParser","expresslogger","req","res","next","logger","old","send","data","content","headers","JSON","parse","session","client","mapper","mapperEnable","response","convert","mapperPrefix","router","static","sessionDirectory","server","listen","port","info","getIPAddress","debug","startAllSession"],"sources":["../../node/express.js"],"sourcesContent":["import cors from 'cors';\nimport express from 'express';\nimport { createServer } from 'http';\nimport boolParser from 'express-query-boolean';\nimport config from './config';\nimport { convert } from './mapper/index';\nimport { expresslogger, logger } from './util/logger';\nimport router from './router';\nimport { getIPAddress, setMaxListners, startAllSession } from './util/functions';\nimport * as exception from 'express-exception-handler';\n\nexception.handle();\nsetMaxListners(config);\nconst app = express();\nconst http = new createServer(app);\n\napp.use(cors());\napp.use(express.json({ limit: '50mb' }));\napp.use(express.urlencoded({ limit: '50mb', extended: true }));\napp.use(boolParser());\napp.use(expresslogger());\napp.use((req, res, next) => {\n  req.config = config;\n  req.logger = logger;\n  var old = res.send;\n  res.send = async data => {\n    const content = req.headers['content-type'];\n    if (content === 'application/json') {\n      data = JSON.parse(data);\n      if (!data.session) {\n        data.session = req.client ? req.client.session : '';\n      }\n      if (data.mapper && req.config.mapperEnable) {\n        data.response = await convert(req.config.mapperPrefix, data.response, data.mapper);\n        delete data.mapper;\n      }\n    }\n    res.send = old;\n    return res.send(data);\n  };\n  next();\n});\napp.use('/', router);\napp.use('/static', express.static(config.sessionDirectory));\nexport const server = http.listen(config.port, () => {\n  logger.info(`Server is running on port ${config.port}`);\n  logger.info(`Visit http://localhost:${config.port}/api/ping, http://${getIPAddress()}:${config.port}/api/ping`);\n  logger.debug(config);\n  if (config.startAllSession) {\n    startAllSession(config, logger);\n  }\n});\n"],"mappings":"wLAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8E;;AAEAA,SAAS,CAACC,MAAV;AACA,IAAAC,yBAAA,EAAeC,eAAf;AACA,MAAMC,GAAG,GAAG,IAAAC,gBAAA,GAAZ;AACA,MAAMC,IAAI,GAAG,IAAIC,kBAAJ,CAAiBH,GAAjB,CAAb;;AAEAA,GAAG,CAACI,GAAJ,CAAQ,IAAAC,aAAA,GAAR;AACAL,GAAG,CAACI,GAAJ,CAAQH,gBAAA,CAAQK,IAAR,CAAa,EAAEC,KAAK,EAAE,MAAT,EAAb,CAAR;AACAP,GAAG,CAACI,GAAJ,CAAQH,gBAAA,CAAQO,UAAR,CAAmB,EAAED,KAAK,EAAE,MAAT,EAAiBE,QAAQ,EAAE,IAA3B,EAAnB,CAAR;AACAT,GAAG,CAACI,GAAJ,CAAQ,IAAAM,4BAAA,GAAR;AACAV,GAAG,CAACI,GAAJ,CAAQ,IAAAO,qBAAA,GAAR;AACAX,GAAG,CAACI,GAAJ,CAAQ,CAACQ,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;EAC1BF,GAAG,CAACb,MAAJ,GAAaA,eAAb;EACAa,GAAG,CAACG,MAAJ,GAAaA,cAAb;EACA,IAAIC,GAAG,GAAGH,GAAG,CAACI,IAAd;EACAJ,GAAG,CAACI,IAAJ,GAAW,OAAMC,IAAN,KAAc;IACvB,MAAMC,OAAO,GAAGP,GAAG,CAACQ,OAAJ,CAAY,cAAZ,CAAhB;IACA,IAAID,OAAO,KAAK,kBAAhB,EAAoC;MAClCD,IAAI,GAAGG,IAAI,CAACC,KAAL,CAAWJ,IAAX,CAAP;MACA,IAAI,CAACA,IAAI,CAACK,OAAV,EAAmB;QACjBL,IAAI,CAACK,OAAL,GAAeX,GAAG,CAACY,MAAJ,GAAaZ,GAAG,CAACY,MAAJ,CAAWD,OAAxB,GAAkC,EAAjD;MACD;MACD,IAAIL,IAAI,CAACO,MAAL,IAAeb,GAAG,CAACb,MAAJ,CAAW2B,YAA9B,EAA4C;QAC1CR,IAAI,CAACS,QAAL,GAAgB,MAAM,IAAAC,cAAA,EAAQhB,GAAG,CAACb,MAAJ,CAAW8B,YAAnB,EAAiCX,IAAI,CAACS,QAAtC,EAAgDT,IAAI,CAACO,MAArD,CAAtB;QACA,OAAOP,IAAI,CAACO,MAAZ;MACD;IACF;IACDZ,GAAG,CAACI,IAAJ,GAAWD,GAAX;IACA,OAAOH,GAAG,CAACI,IAAJ,CAASC,IAAT,CAAP;EACD,CAdD;EAeAJ,IAAI;AACL,CApBD;AAqBAd,GAAG,CAACI,GAAJ,CAAQ,GAAR,EAAa0B,eAAb;AACA9B,GAAG,CAACI,GAAJ,CAAQ,SAAR,EAAmBH,gBAAA,CAAQ8B,MAAR,CAAehC,eAAA,CAAOiC,gBAAtB,CAAnB;AACO,MAAMC,MAAM,GAAG/B,IAAI,CAACgC,MAAL,CAAYnC,eAAA,CAAOoC,IAAnB,EAAyB,MAAM;EACnDpB,cAAA,CAAOqB,IAAP,CAAa,6BAA4BrC,eAAA,CAAOoC,IAAK,EAArD;EACApB,cAAA,CAAOqB,IAAP,CAAa,0BAAyBrC,eAAA,CAAOoC,IAAK,qBAAoB,IAAAE,uBAAA,GAAe,IAAGtC,eAAA,CAAOoC,IAAK,WAApG;EACApB,cAAA,CAAOuB,KAAP,CAAavC,eAAb;EACA,IAAIA,eAAA,CAAOwC,eAAX,EAA4B;IAC1B,IAAAA,0BAAA,EAAgBxC,eAAhB,EAAwBgB,cAAxB;EACD;AACF,CAPqB,CAAf,C"}