{"version":3,"file":"connection.js","names":["verifyConnection","req","res","next","client","array","jidToArray","body","toJid","fromJid","jid","index","indexOf","verifyJid","splice","status","json","connected","error","e","logger","message"],"sources":["../../../node/midleware/connection.js"],"sourcesContent":["import { jidToArray, verifyJid } from '../util/functions';\n\nexport default async function verifyConnection(req, res, next) {\n  try {\n    if (req.client) {\n      let array = jidToArray(req.body.toJid ? req.body.toJid : req.body.fromJid ? req.body.fromJid : []);\n      for (const jid of array) {\n        const index = array.indexOf(jid);\n        if (!(await verifyJid(req.client, jid))) {\n          array.splice(index, 1);\n        }\n      }\n      req.body.toJid = req.body.fromJid = array;\n    } else {\n      return res.status(404).json({\n        connected: false,\n        error: 'WhatsApp session is not active',\n      });\n    }\n    next();\n  } catch (e) {\n    req.logger.error(e);\n    return res.status(404).json({\n      error: e.message,\n    });\n  }\n}\n"],"mappings":"8GAAA;;AAEe,eAAeA,gBAAf,CAAgCC,GAAhC,EAAqCC,GAArC,EAA0CC,IAA1C,EAAgD;EAC7D,IAAI;IACF,IAAIF,GAAG,CAACG,MAAR,EAAgB;MACd,IAAIC,KAAK,GAAG,IAAAC,qBAAA,EAAWL,GAAG,CAACM,IAAJ,CAASC,KAAT,GAAiBP,GAAG,CAACM,IAAJ,CAASC,KAA1B,GAAkCP,GAAG,CAACM,IAAJ,CAASE,OAAT,GAAmBR,GAAG,CAACM,IAAJ,CAASE,OAA5B,GAAsC,EAAnF,CAAZ;MACA,KAAK,MAAMC,GAAX,IAAkBL,KAAlB,EAAyB;QACvB,MAAMM,KAAK,GAAGN,KAAK,CAACO,OAAN,CAAcF,GAAd,CAAd;QACA,IAAI,EAAE,MAAM,IAAAG,oBAAA,EAAUZ,GAAG,CAACG,MAAd,EAAsBM,GAAtB,CAAR,CAAJ,EAAyC;UACvCL,KAAK,CAACS,MAAN,CAAaH,KAAb,EAAoB,CAApB;QACD;MACF;MACDV,GAAG,CAACM,IAAJ,CAASC,KAAT,GAAiBP,GAAG,CAACM,IAAJ,CAASE,OAAT,GAAmBJ,KAApC;IACD,CATD,MASO;MACL,OAAOH,GAAG,CAACa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;QAC1BC,SAAS,EAAE,KADe;QAE1BC,KAAK,EAAE,gCAFmB,EAArB,CAAP;;IAID;IACDf,IAAI;EACL,CAjBD,CAiBE,OAAOgB,CAAP,EAAU;IACVlB,GAAG,CAACmB,MAAJ,CAAWF,KAAX,CAAiBC,CAAjB;IACA,OAAOjB,GAAG,CAACa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;MAC1BE,KAAK,EAAEC,CAAC,CAACE,OADiB,EAArB,CAAP;;EAGD;AACF"}