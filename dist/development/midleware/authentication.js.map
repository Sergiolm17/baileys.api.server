{"version":3,"file":"authentication.js","names":["formatSession","session","split","verifyToken","req","res","next","secureToken","config","secretKey","params","authorization","token","headers","status","send","error","tokenDecrypt","sessionDecrypt","replace","length","value","json","e","logger","detail","bcrypt","compare","err","result","client","clientsArray"],"sources":["../../../node/midleware/authentication.js"],"sourcesContent":["import bcrypt from 'bcrypt';\nimport { clientsArray } from '../util/variable';\n\nfunction formatSession(session) {\n  return session.split(':')[0];\n}\nconst verifyToken = (req, res, next) => {\n  const secureToken = req.config.secretKey;\n  const { session } = req.params;\n  const { authorization: token } = req.headers;\n  if (!session) {\n    return res.status(401).send({ error: 'Session not informed' });\n  }\n  try {\n    let tokenDecrypt = '';\n    let sessionDecrypt = '';\n    try {\n      sessionDecrypt = session.split(':')[0];\n      tokenDecrypt = session.split(':')[1].replace(/_/g, '/').replace(/-/g, '+');\n    } catch (error) {\n      try {\n        if (token && token !== '' && token.split(' ').length > 0) {\n          const value = token.split(' ')[1];\n          if (value) tokenDecrypt = value.replace(/_/g, '/').replace(/-/g, '+');\n          else return res.status(401).json({ error: 'Token is not present. Check your header and try again' });\n        } else {\n          return res.status(401).json({ error: 'Token is not present. Check your header and try again' });\n        }\n      } catch (e) {\n        req.logger.error(e);\n        return res.status(401).json({ error: 'Check that a Session and Token are correct', detail: error });\n      }\n    }\n    bcrypt.compare(sessionDecrypt + secureToken, tokenDecrypt, function (err, result) {\n      if (result) {\n        req.session = formatSession(req.params.session);\n        req.token = tokenDecrypt;\n        req.client = clientsArray[req.session];\n        next();\n      } else {\n        return res.status(401).json({ error: 'Check that the Session and Token are correct' });\n      }\n    });\n  } catch (e) {\n    req.logger.error(e);\n    return res.status(401).json({\n      error: 'Check that the Session and Token are correct.',\n      detail: e,\n    });\n  }\n};\n\nexport default verifyToken;\n"],"mappings":"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"}