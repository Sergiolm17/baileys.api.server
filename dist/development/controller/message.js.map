{"version":3,"file":"message.js","names":["sendText","req","res","toJid","message","type","simulation","body","content","option","results","jid","client","presenceSubscribe","delay","sendPresenceUpdate","push","sendMessage","forward","text","length","status","json","error","response","e","logger","sendMedia","caption","path","send","file","fileName","Object","assign","originalname","mimetype","mime","lookup","startsWith","url","fs","readFileSync","buffer","ptt","sendImage","sendVideo","sendAudio","sendDocument","sendSticker","prepareButton","buttons","template","map","button","index","quickReplyButton","id","title","displayText","callButton","phoneNumber","payload","urlButton","sendButton","footer","templateButtons","sendMediaButton","sendList","buttonText","sections","sendContact","fullName","organization","contacts","displayName","vcard","reaction","emoticon","react","key","loadMessages","fromJid","limit","onlyFromMe","onlyNotFromMe","store","fromMe","loadMessage","sendReadReceipt","remoteJid","participant","success"],"sources":["../../../node/controller/message.js"],"sourcesContent":["import fs from 'fs';\nimport * as mime from 'mime-types';\nimport { delay } from '@adiwajshing/baileys';\n\nexport async function sendText(req, res) {\n  const { toJid, message, type, simulation = true } = req.body;\n  const content = req.body.content ? req.body.content : {};\n  const option = req.body.option ? req.body.option : {};\n  try {\n    let results = [];\n    for (const jid of toJid) {\n      if (simulation) {\n        await req.client.presenceSubscribe(jid);\n        await delay(500);\n        await req.client.sendPresenceUpdate('composing', jid);\n      }\n      if (typeof message === 'object') {\n        results.push(\n          await req.client.sendMessage(\n            jid,\n            {\n              forward: message,\n              ...content,\n            },\n            {\n              ...option,\n            },\n          ),\n        );\n      } else if (typeof message === 'undefined') {\n        results.push(\n          await req.client.sendMessage(\n            jid,\n            {\n              ...content,\n            },\n            {\n              ...option,\n            },\n          ),\n        );\n      } else {\n        results.push(\n          await req.client.sendMessage(\n            jid,\n            {\n              text: message,\n              ...content,\n            },\n            {\n              ...option,\n            },\n          ),\n        );\n      }\n    }\n    if (results.length === 0) {\n      return res.status(400).json({\n        error: 'No message send, please verify',\n      });\n    }\n    res.status(201).json({ response: results });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error sent ${type ? type : 'text'} message, ${e.message}`,\n    });\n  } finally {\n    for (const jid of toJid) {\n      await req.client.sendPresenceUpdate('paused', jid);\n    }\n  }\n}\n\nexport async function sendMedia(req, res) {\n  const { toJid, type, caption, path, simulation = true } = req.body;\n  if (!type) {\n    return res.status(401).send({\n      error: `Sending media required type`,\n    });\n  }\n  if (!path && !req.file) {\n    return res.status(401).send({\n      error: `Sending the ${type} is required`,\n    });\n  }\n  const content = req.body.content ? req.body.content : {};\n  if (!content.fileName) {\n    Object.assign(content, {\n      fileName: req.file ? req.file.originalname : type,\n      ...content,\n    });\n  }\n  const option = req.body.option ? req.body.option : {};\n  try {\n    let results = [];\n    for (const jid of toJid) {\n      if (simulation) {\n        await req.client.presenceSubscribe(jid);\n        await delay(500);\n        if (type === 'audio') {\n          await req.client.sendPresenceUpdate('recording', jid);\n        } else {\n          await req.client.sendPresenceUpdate('composing', jid);\n        }\n      }\n      results.push(\n        await req.client.sendMessage(\n          jid,\n          {\n            mimetype: path ? mime.lookup(path) : req.file.mimetype,\n            [type]: path ? (path.startsWith('http') ? { url: path } : fs.readFileSync(path)) : req.file.buffer,\n            caption: caption,\n            ptt: type === 'audio',\n            ...content,\n          },\n          {\n            ...option,\n          },\n        ),\n      );\n    }\n    if (results.length === 0) {\n      return res.status(400).json({\n        error: 'No message send, please verify jid',\n      });\n    }\n    res.status(201).json({ response: results });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error sent ${type} message, ${e.message}`,\n    });\n  } finally {\n    for (const jid of toJid) {\n      await req.client.sendPresenceUpdate('paused', jid);\n    }\n  }\n}\n\nexport async function sendImage(req, res) {\n  Object.assign(req, {\n    body: {\n      type: 'image',\n      ...req.body,\n    },\n  });\n  return await sendMedia(req, res);\n}\n\nexport async function sendVideo(req, res) {\n  Object.assign(req, {\n    body: {\n      type: 'video',\n      ...req.body,\n    },\n  });\n  return await sendMedia(req, res);\n}\n\nexport async function sendAudio(req, res) {\n  Object.assign(req, {\n    body: {\n      type: 'audio',\n      ...req.body,\n    },\n  });\n  return await sendMedia(req, res);\n}\n\nexport async function sendDocument(req, res) {\n  Object.assign(req, {\n    body: {\n      type: 'document',\n      ...req.body,\n    },\n  });\n  return await sendMedia(req, res);\n}\n\nexport async function sendSticker(req, res) {\n  Object.assign(req, {\n    body: {\n      type: 'sticker',\n      ...req.body,\n    },\n  });\n  return await sendMedia(req, res);\n}\n\nfunction prepareButton(buttons) {\n  let template = [];\n  buttons.map((button, index) => {\n    if (button.type === 'replyButton') {\n      template.push({\n        quickReplyButton: {\n          index: button.index ? button.index : index + 1,\n          id: button.id ? button.id : button.title,\n          displayText: button.title ?? '',\n        },\n      });\n    }\n    if (button.type === 'callButton') {\n      template.push({\n        callButton: {\n          index: button.index ? button.index : index + 1,\n          displayText: button.title ?? '',\n          phoneNumber: button.payload ?? '',\n        },\n      });\n    }\n    if (button.type === 'urlButton') {\n      template.push({\n        urlButton: {\n          index: button.index ? button.index : index + 1,\n          displayText: button.title ?? '',\n          url: button.payload ?? '',\n        },\n      });\n    }\n  });\n  return template;\n}\n\nexport async function sendButton(req, res) {\n  const { footer, buttons } = req.body;\n  const content = req.body.content ? req.body.content : {};\n  Object.assign(content, {\n    footer: footer,\n    templateButtons: prepareButton(buttons),\n  });\n  Object.assign(req, {\n    body: {\n      type: 'button',\n      content: content,\n      ...req.body,\n    },\n  });\n  return await sendText(req, res);\n}\n\nexport async function sendMediaButton(req, res) {\n  const { footer, buttons } = req.body;\n  const content = req.body.content ? req.body.content : {};\n  Object.assign(content, {\n    footer: footer,\n    templateButtons: prepareButton(buttons),\n  });\n  Object.assign(req, {\n    body: {\n      content: content,\n      ...req.body,\n    },\n  });\n  return await sendMedia(req, res);\n}\n\nexport async function sendList(req, res) {\n  const { title, buttonText, footer, sections } = req.body;\n  const content = req.body.content ? req.body.content : {};\n  Object.assign(content, {\n    footer: footer,\n    sections: sections,\n    buttonText: buttonText,\n    title: title,\n  });\n  Object.assign(req, {\n    body: {\n      type: 'list',\n      content: content,\n      ...req.body,\n    },\n  });\n  return await sendText(req, res);\n}\nexport async function sendContact(req, res) {\n  const { phoneNumber } = req.body;\n  let { fullName, organization } = req.body;\n  fullName = fullName ? fullName : phoneNumber;\n  organization = organization ? organization : fullName;\n  const content = req.body.content ? req.body.content : {};\n  Object.assign(content, {\n    contacts: {\n      displayName: fullName,\n      contacts: [\n        {\n          displayName: fullName,\n          vcard: `BEGIN:VCARD\nVERSION:3.0\nFN:${fullName}\nORG:${organization};\nTEL;type=CELL;type=VOICE;waid=${phoneNumber}:${phoneNumber}\\n\nEND:VCARD`,\n        },\n      ],\n    },\n  });\n  Object.assign(req, {\n    body: {\n      type: 'contact',\n      content: content,\n      ...req.body,\n    },\n  });\n  return await sendText(req, res);\n}\nexport async function forward(req, res) {\n  const { message } = req.body;\n  const content = req.body.content ? req.body.content : {};\n  Object.assign(content, {\n    forward: message,\n  });\n  Object.assign(req, {\n    body: {\n      type: 'forward',\n      content: content,\n      ...req.body,\n    },\n  });\n  return await sendText(req, res);\n}\nexport async function reaction(req, res) {\n  const { message, emoticon } = req.body;\n  const content = req.body.content ? req.body.content : {};\n  Object.assign(content, {\n    react: {\n      text: emoticon,\n      key: message.key ? message.key : message,\n    },\n  });\n  Object.assign(req, {\n    body: {\n      type: 'emoticon',\n      content: content,\n      ...req.body,\n    },\n  });\n  return await sendText(req, res);\n}\n\nexport async function loadMessages(req, res) {\n  const { fromJid, limit, onlyFromMe = false, onlyNotFromMe = false } = req.body;\n  try {\n    let results = [];\n    for (const jid of fromJid) {\n      for (const message of await req.client.store.loadMessages(jid, limit)) {\n        if (onlyFromMe && message && message.key.fromMe) {\n          results.push(message);\n        }\n        if (onlyNotFromMe && message && !message.key.fromMe) {\n          results.push(message);\n        }\n      }\n    }\n    if (results.length === 0) {\n      return res.status(400).json({\n        error: `No messages can load ${onlyFromMe ? 'only from me, ' : ', '}${onlyNotFromMe ? 'only not from me' : ''}`,\n      });\n    }\n    res.status(201).json({ response: results });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error load messages, ${e.message}`,\n    });\n  }\n}\nexport async function loadMessage(req, res) {\n  const { fromJid, id } = req.body;\n  try {\n    let results = [];\n    for (const jid of fromJid) {\n      const message = await req.client.store.loadMessage(jid, id);\n      if (message) {\n        results.push(message);\n      }\n    }\n    if (results.length === 0) {\n      return res.status(400).json({\n        error: `No message can load with id ${id}`,\n      });\n    }\n    res.status(201).json({ response: results });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error load message, ${e.message}`,\n    });\n  }\n}\nexport async function sendReadReceipt(req, res) {\n  const { message } = req.body;\n  try {\n    let key = message.key ? message.key : message;\n    await req.client.sendReadReceipt(key.remoteJid, key.participant, [key.id]);\n    res.status(201).json({ success: `Message successfull receipt`, message: key });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error receipt message, ${e.message}`,\n    });\n  }\n}\n"],"mappings":"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"}