{"version":3,"file":"chat.js","names":["sendPresenceUpdate","req","res","toJid","presence","body","results","jid","result","client","push","length","status","json","error","response","e","logger","message","onWhatsApp","fromJid","profilePictureUrl","hd","undefined","fetchStatus","presenceSubscribe","chats","unreadOnly","chat","store","all","unreadCount"],"sources":["../../../node/controller/chat.js"],"sourcesContent":["export async function sendPresenceUpdate(req, res) {\n  const { toJid, presence } = req.body;\n  try {\n    let results = [];\n    for (const jid of toJid) {\n      const result = await req.client.sendPresenceUpdate(presence, jid);\n      results.push(result ? result : jid);\n    }\n    if (results.length === 0) {\n      return res.status(400).json({\n        error: `No presence can send`,\n      });\n    }\n    res.status(201).json({ response: results });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error send presence, ${e.message}`,\n    });\n  }\n}\nexport async function onWhatsApp(req, res) {\n  const { fromJid } = req.body;\n  try {\n    let results = [];\n    for (const jid of fromJid) {\n      const result = await req.client.onWhatsApp(jid);\n      results.push(result ? result : {});\n    }\n    if (results.length === 0) {\n      return res.status(400).json({\n        error: `No jid on whatsapp`,\n      });\n    }\n    res.status(201).json({ response: results });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error on whatsapp, ${e.message}`,\n    });\n  }\n}\nexport async function profilePictureUrl(req, res) {\n  const { fromJid, hd = false } = req.body;\n  try {\n    let results = [];\n    for (const jid of fromJid) {\n      const result = await req.client.profilePictureUrl(jid, hd ? 'image' : undefined);\n      results.push(result ? result : {});\n    }\n    if (results.length === 0) {\n      return res.status(400).json({\n        error: `No profile picture on whatsapp`,\n      });\n    }\n    res.status(201).json({ response: results });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error profile picture, ${e.message}`,\n    });\n  }\n}\nexport async function fetchStatus(req, res) {\n  const { fromJid } = req.body;\n  try {\n    let results = [];\n    for (const jid of fromJid) {\n      const result = await req.client.fetchStatus(jid);\n      results.push(result ? result : {});\n    }\n    if (results.length === 0) {\n      return res.status(400).json({\n        error: `No status on whatsapp`,\n      });\n    }\n    res.status(201).json({ response: results });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error status, ${e.message}`,\n    });\n  }\n}\nexport async function presenceSubscribe(req, res) {\n  const { fromJid } = req.body;\n  try {\n    let results = [];\n    for (const jid of fromJid) {\n      const result = await req.client.presenceSubscribe(jid);\n      results.push(result ? result : {});\n    }\n    if (results.length === 0) {\n      return res.status(400).json({\n        error: `No presence subscribe`,\n      });\n    }\n    res.status(201).json({ response: results });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error presence subscribe, ${e.message}`,\n    });\n  }\n}\nexport async function chats(req, res) {\n  const { unreadOnly = true } = req.body;\n  try {\n    let results = [];\n    for (const chat of await req.client.store.chats.all()) {\n      if (unreadOnly) {\n        if (chat.unreadCount > 0) {\n          results.push(chat);\n        }\n      } else {\n        results.push(chat);\n      }\n    }\n    if (results.length === 0) {\n      return res.status(400).json({\n        error: `No chats on whatsapp${unreadOnly ? ', with unread only' : ''}`,\n      });\n    }\n    res.status(201).json({ response: results });\n  } catch (e) {\n    req.logger.error(e);\n    res.status(500).json({\n      error: `Error chats, ${e.message}`,\n    });\n  }\n}\n"],"mappings":"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"}